# 5. File Conventions

> Next.jsì€ íŒŒì¼ ê·œì¹™ ë° ë””ë ‰í† ë¦¬ êµ¬ì¡°ì— íŠ¹ì •í•œ ê·œì¹™ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
> ì´ì„ í†µí•´ ë” íš¨ìœ¨ì ì´ê³ , ì¼ê´€ëœ í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.

<br>

## 5-1 page.js

app í´ë” ì„¸ê·¸ë¨¼íŠ¸ì— ë”°ë¼ ì ‘ê·¼ ê°€ëŠ¥í•œ ê²½ë¡œë¡œë¥¼ ë§Œë“¤ë©°, í•´ë‹¹ ë¼ìš°íŠ¸ì— í˜ì´ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

about ì„¸ê·¸ë¨¼íŠ¸ì˜ í˜ì´ì§€ ìƒì„± ì˜ˆì‹œ

```javascript
// app/about/page.js
export default function About() {
  <div>About page</div>;
}
```

<br>

## 5-2. layout.js

ì—¬ëŸ¬ í•˜ìœ„ ê²½ë¡œì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” UIë¥¼ ì œì‘í•˜ê³ , ìŠ¬ë¡¯ ë°©ì‹ìœ¼ë¡œ `children` propsë¥¼ ì‚¬ìš©í•˜ì—¬, í•˜ìœ„ ì„¸ê·¸ë¨¼íŠ¸ë“¤ì„ ë˜í•‘í•©ë‹ˆë‹¤.

ìµœìƒìœ„ ë£¨íŠ¸ layout ì»´í¬ë„ŒíŠ¸, `{children}` ë¶€ë¶„ì—ëŠ” /app/page.tsx ì»´í¬ë„ŒíŠ¸ê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

```javascript
// app/layout.js
import Header from "@/components/Header";

export default function RootLayout({
  children,
}: Readonly<{ children: React.ReactNode }>) {
  return (
    <html lang="ko">
      <body>
        <Header />
        {children}
      </body>
    </html>
  );
}
```

<br>

## 5-3. template.js

layoutê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ navigateì‹œ ì»´í¬ë„ŒíŠ¸ê°€ ìƒˆë¡œ ë§ˆìš´íŠ¸ ëœë‹¤ëŠ” ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.

template UI ìƒì„± ì˜ˆì‹œ

```javascript
// app/about/template.js

export default function AboutTemplate() {
  return (
    <>
      <h1>About</h1>
      <p>Total Visitor : {visitor}</p>
    </>
  );
}
```

<br>

## 5-4. loading.js

ìë™ìœ¼ë¡œ í˜ì´ì§€ ë˜ëŠ” ì¤‘ì²©ëœ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ `Suspense Boundary`ë¡œ ë˜í•‘í•´ì£¼ê³ , `Susnpense Boundary` ë‚´ë¶€ì—ì„œ í˜ì´ì§€ í˜¹ì€ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ì— fallback UIë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

loading UI ìƒì„± ì˜ˆì‹œ

```javascript
// app/loading.js

export default function Loading() {
  return <p>Loading...</p>;
}
```

<br>

## 5-5. error.js

ìë™ìœ¼ë¡œ í˜ì´ì§€ ë˜ëŠ” ì¤‘ì²©ëœ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ `Error Boundary`ë¡œ ë˜í•‘í•´ì£¼ê³ , `Error Boundary` ë‚´ë¶€ì—ì„œ í˜ì´ì§€ í˜¹ì€ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ì— fallback UIë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. propsë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬ëœ `Error ê°ì²´`ì™€ ì—ëŸ¬ ë°”ìš´ë”ë¦¬ì˜ ì»¨í…ì¸ ë¥¼ ë¦¬ë Œë”ë§í•˜ëŠ” `reset í•¨ìˆ˜`ë¥¼ ë°›ì„ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Error UI ìƒì„± ì˜ˆì‹œ

```javascript
// app/loading.js

export default function Error({ error, reset }) {
  "use client";

  return (
    <div>
      <h2>Something went wrong!</h2>
      <button onClick={() => reset()}>Try again</button>
    </div>
  );
}
```

<br>

## 5-6. global-error.js

errorì™€ ë¹„ìŠ·í•˜ì§€ë§Œ root layoutì˜ ì—ëŸ¬ë¥¼ ì¡ì•„ì¤ë‹ˆë‹¤.

```javascript
'use client'

export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    <html>
      <body>
        <h2>Something went wrong!</h2>
        <button onClick={() => reset()}>Try again</button>
      </body>
    </html>
  )
}
```

<br>

## 5-7. not-found.js

ê²½ë¡œì™€ ë§¤ì¹­ë˜ëŠ” í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš° í‘œì‹œë˜ëŠ” UI í˜ì´ì§€ì…ë‹ˆë‹¤.

```javascript
// app/not-found.js
import Link from "next/link";

export default function NotFound() {
  return (
    <div>
      <h2>Not Found</h2>
      <p>Could not find requested resource</p>
      <Link href="/">Return Home</Link>
    </div>
  );
}
```

<br>

## 5-8. default.js

Next.jsê°€ ì „ì²´ í˜ì´ì§€ ë¡œë“œ í›„ í´ë”ì˜ í•˜ìœ„ í˜ì´ì§€ë¥¼ ë³µêµ¬í•  ìˆ˜ ì—†ì„ ë•Œ Parallel Routes default.js ë‚´ì—ì„œ fallbackì„ ë Œë”ë§í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

<a href="https://github.com/NamJongtae/nextjs-study/blob/main/nextjs_%EA%B0%9C%EB%85%90/App_Router/1.Routing.md?#1-7--%EB%9D%BC%EC%9A%B0%ED%8A%B8-%EA%B0%80%EB%A1%9C%EC%B1%84%EA%B8%B0-intercepting-routes">ì°¸ê³  ì‚¬ìš©ì˜ˆì‹œ</a>

<br>

## 5-9. route.js

API Routeë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ íŒŒì¼ë¡œ ë™ì‘í•˜ë©°, ì§€ì •ëœ ê²½ë¡œì— ëŒ€í•œ ì‚¬ìš©ì ì •ì˜ ìš”ì²­ í•¸ë“¤ëŸ¬(GET, HEAD, POST, PUT, DELETE, PATCH)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```javascript
export async function GET(request: Request) {}

export async function HEAD(request: Request) {}

export async function POST(request: Request) {}

export async function PUT(request: Request) {}

export async function DELETE(request: Request) {}

export async function PATCH(request: Request) {}
```

<br>

## 5-10. instrumentation.js

ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ê³¼ ë¡œê¹…ì„ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” íŒŒì¼ì…ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ê³¼ ë™ì‘ì„ ì¶”ì í•˜ê³  ë¬¸ì œë¥¼ ë””ë²„ê¹…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
instrumentation ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” next.config.jsì— `experimental.instrumentationHook` ì†ì„±ì„ trueë¡œ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.
ìƒˆë¡œìš´ Next.js ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹œì‘ë  ë•Œ í•œ ë²ˆ register í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤.

```javascript
module.exports = {
  experimental: {
    instrumentationHook: true,
  },
};
```

```javascript
export function register() {
  // ë¶€íŠ¸ ë  ë•Œ ë§ˆë‹¤ ìµœì´ˆ í•œë²ˆ ì‹¤í–‰ë˜ì–´ì•¼ í•  ë¡œì§
  // ...
}
```

<br>

## 5-11. middleware.js

ë¯¸ë“¤ì›¨ì–´ì˜ ì½”ë“œëŠ” ìš”ì²­ì´ ì‹¤ì œ í˜ì´ì§€ì— ë„ë‹¬í•˜ê¸° ì „ì— ì‹¤í–‰ë˜ë©°, ì¸ì¦, ë¡œê¹…, ë¦¬ë‹¤ì´ë ‰ì…˜ ë“±ì˜ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`config.matcher`ë¥¼ ì´ìš©í•˜ì—¬ ì ìš©í•  í˜ì´ì§€ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`middleware`ë¥¼ ì´ìš©í•˜ì—¬ í† í°ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ëŠ” ì˜ˆì‹œ

```javascript
import { NextResponse } from "next/server";
import { getToken } from "@/lib/api";

export function middleware() {
  const token = await getToken();

  if (!token) {
    return NextResponse.redirect("/signin");
  }
}

export const config = {
  matcher: ["/about/:path*", "/posts/:path*"]
};
```

<br>

## 5-12. favicon, icon, apple-icon

ë””ë ‰í† ë¦¬ ë‚´ì— favicon, icon, ë˜ëŠ” ì´ë¯¸ì§€ íŒŒì¼ ì„ ë°°ì¹˜í•˜ì—¬ ì´ë¯¸ì§€ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì•± ì•„ì´ì½˜ì„ ì„¤ì •í•©ë‹ˆë‹¤.
favicon íŒŒì¼ì€ app í´ë” ìœ„ì¹˜ì—ì„œ ì ìš©ë©ë‹ˆë‹¤. icon, apple-icon íŒŒì¼ì€ app í•˜ìœ„ ë””ë ‰í† ë¦¬ê¹Œì§€ ì ìš©ë©ë‹ˆë‹¤.

| íŒŒì¼ ê·œì¹™  | ì§€ì›ë˜ëŠ” íŒŒì¼ ìœ í˜•            | ìœ íš¨í•œ ìœ„ì¹˜ |
| ---------- | ----------------------------- | ----------- |
| favicon    | .ico                          | app/        |
| icon       | .ico, .jpg, .jpeg, .png, .svg | app/\*_/_   |
| apple-icon | .jpg, .jpeg, .png             | app/\*_/_   |

<br>

ì•„ë˜ êµ¬ì¡°ì™€ ê°™ì´ favicon, icon ,apple-iconë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`/`, `/news`, `/about` í˜ì´ì§€ë§ˆë‹¤ icon, apple-iconì´ ë‹¬ë¼ì§€ê²Œë©ë‹ˆë‹¤.

```javascript
ğŸ“¦app
 â”£ ğŸ“‚news
 â”ƒ  â”— ğŸ“œpage.js
 â”ƒ  â”— ğŸ“œicon.jpg
 â”ƒ  â”— ğŸ“œapple-icon.jpg
 â”£ ğŸ“‚about
 â”ƒ  â”— ğŸ“œpage.js
 â”ƒ  â”— ğŸ“œicon.jpg
 â”ƒ  â”— ğŸ“œapple-icon.jpg
 â”ƒ ğŸ“œapple-icon.jpg
 â”£ ğŸ“œfavicon.ico
 â”£ ğŸ“œglobals.css
 â”£ ğŸ“œicon.jpg
 â”£ ğŸ“œlayout.js
 â”— ğŸ“œpage.js
```

<br>

## 5-13. opengraph-image, twitter-image

ê° ì„¸ê·¸ë¨¼íŠ¸ì— ëŒ€í•œ OpenGraph ë° Twitter ì´ë¯¸ì§€ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

| íŒŒì¼ ê·œì¹™           | ì§€ì›ë˜ëŠ” íŒŒì¼ ìœ í˜•      |
| ------------------- | ----------------------- |
| opengraph-image     | .jpg, .jpeg, .png, .gif |
| twitter-image       | .jpg, .jpeg, .png, .gif |
| opengraph-image.alt | .txt                    |
| twitter-image.alt   | .txt                    |

<br>

ì•„ë˜ êµ¬ì¡°ì™€ ê°™ì´ favicon, icon ,apple-iconë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
`/about` í˜ì´ì§€ì— ì ìš©ë  opengraph-image meta íƒœê·¸ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
ğŸ“¦app
 â”£ ğŸ“‚about
 â”ƒ  â”— ğŸ“œpage.js
 â”ƒ  â”— ğŸ“œopengraph-image.alt.txt
 â”ƒ  â”— ğŸ“œopengraph-image.png
 â”ƒ ğŸ“œapple-icon.jpg
 â”£ ğŸ“œfavicon.ico
 â”£ ğŸ“œglobals.css
 â”£ ğŸ“œicon.jpg
 â”£ ğŸ“œlayout.js
 â”— ğŸ“œpage.js
```

<br>

opengraph-image ì„¤ì •ì‹œ ì•„ë˜ì™€ ê°™ì€ ë©”íƒ€ íƒœê·¸ë“¤ì´ `head` íƒœê·¸ì•ˆì— ìƒì„±ë©ë‹ˆë‹¤.

```javascript
<meta property="og:image" content="<generated>" />
<meta property="og:image:type" content="<generated>" />
<meta property="og:image:width" content="<generated>" />
<meta property="og:image:height" content="<generated>" />
```

<br>

opengraph-image.alt ì„¤ì •

```javascript
// app/about/opengraph-image.alt

About;
```

ìœ„ì™€ ê°™ì´ íŒŒì¼ì„ ì„¤ì •í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ë©”íƒ€ íƒœê·¸ê°€ `head` íƒœê·¸ì•ˆì— ìƒì„±ë©ë‹ˆë‹¤.

```html
<meta property="opengraph:image:alt" content="About" />
```

<br>

opengraph-image, twitter-image íŒŒì¼ì„ ë§Œë“¤ì–´ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ìƒì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

| íŒŒì¼ ê·œì¹™       | ì§€ì›ë˜ëŠ” íŒŒì¼ ìœ í˜• |
| --------------- | ------------------ |
| opengraph-image | .js, .ts, .tsx     |
| twitter-image   | .js, .ts, .tsx     |

<br>

íŒŒì¼ì„ ë§Œë“¤ì–´ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ìƒì„±í•˜ëŠ” ì˜ˆì‹œ

```javascript
// app/about/opengraph-image.js
import { ImageResponse } from "next/og";

// Route segment config
export const runtime = "edge";

// Image metadata
export const alt = "About Acme";
export const size = {
  width: 1200,
  height: 630,
};

export const contentType = "image/png";

// Image generation
export default async function Image() {
  // Font
  const interSemiBold = fetch(
    new URL("./Inter-SemiBold.ttf", import.meta.url)
  ).then((res) => res.arrayBuffer());

  return new ImageResponse(
    (
      // ImageResponse JSX element
      <div
        style={{
          fontSize: 128,
          background: "white",
          width: "100%",
          height: "100%",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
        }}
      >
        About Acme
      </div>
    ),
    // ImageResponse options
    {
      // For convenience, we can re-use the exported opengraph-image
      // size config to also set the ImageResponse's width and height.
      ...size,
      fonts: [
        {
          name: "Inter",
          data: await interSemiBold,
          style: "normal",
          weight: 400,
        },
      ],
    }
  );
}
```

<br>

ìœ„ì™€ ê°™ì´ ì´ë¯¸ì§€ íŒŒì¼ì„ ìƒì„±í•œë‹¤ë©´ ì•„ë˜ì™€ ê°™ì€ ë©”íƒ€ íƒœê·¸ë“¤ì´ `head`íƒœê·¸ì— ìƒì„±ë©ë‹ˆë‹¤.

```html
<meta property="og:image" content="<generated>" />
<meta property="og:image:alt" content="About Acme" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
```

<br>

## ì°¸ê³  ì‚¬ì´íŠ¸

https://nextjs.org/docs/app/api-reference/file-conventions
