# 1. Routing
## 1-0. App Routing ?
>  Server Component, Streaming 과 같은 리액트의 최근 특징들을 사용할 수 있도록 하는 Nextjs의 새로운 라우터입니다.

<br>

## 1-1. 파일 기반 라우팅
### 설명
app 폴더를 기준으로 파일 시스템 라우팅을 구현할 수 있습니다. 각 폴더는 URL 세그먼트에 매핑되는 경로 세그먼트를 나타냅니다. 
중첩된 경로를 만들려면 폴더를 서로 중첩할 수 있습니다. 
page.js 파일은 해당 경로의 페이지 컴포넌트가 됩니다.

### 예시
```text
📦app
 ┣ 📂news
 ┃ ┗ 📜page.js
 ┣ 📂about
 ┃  ┗ 📜page.js
 ┣ 📜favicon.ico
 ┣ 📜globals.css
 ┣ 📜layout.js
 ┗ 📜page.js
```
위와 같은 구조에서는 **/, /news, /about** 경로가 생성됩니다.

<br>

## 1-2. 동적 라우팅 (Dynamic Routes)
### 설명
동적 세그먼트 폴더를 생성하여 동적 라우팅을 구성할 수 있습니다.
동적 세그먼트 폴더 이름을 `대괄호([])`로 묶어 생성 할 수 있습니다.
동적 세그먼트는 컴포넌트의 props의 params로 전달됩니다.

### 예시
```text
📦app
 ┣ 📂news
 ┃ ┗ 📜page.js
 ┣ 📂product
 ┃ ┗ 📂[prodcutId]
 ┃ ┃ ┗ 📜page.js
 ┣ 📜favicon.ico
 ┣ 📜globals.css
 ┣ 📜layout.js
 ┗ 📜page.js
```
product 페이지에서는 productId가 동적 세그먼트 값이 되며, 이 값은 props의 params를 통해 불러올 수 있습니다.
```javascript
export default fuction Product({ params }) {
  retrun <div>{ params.productId } 상품 페이지</div>
}
```

<br>

## 1-3. 중첩 라우트 (Nested Routes)
### 설명
폴더 구조를 중첩하여 중첩 라우팅을 구성할 수 있습니다.

### 예시
```text
📦app
 ┣ 📂news
 ┃ ┣ 📂popular
 ┃ ┃ ┗ 📜page.js
 ┃ ┣ 📂latest
 ┃ ┃ ┗ 📜page.js
 ┃ ┗ 📜page.js
 ┣ 📜favicon.ico
 ┣ 📜globals.css
 ┣ 📜layout.js
 ┗ 📜page.js
```
위와 같은 구조에서는 **/new/popluar, /news/latest** 중첩된 라우팅을 구성할 수 있습니다.

<br>

## 1-4. 모든 경로 처리 라우트 (Catch All Routes)
### 설명
동적 세그먼트 폴더 이름 `대괄호([])`에 `...`를 추가하여 `[...]`형식으로 생성 할 수 있습니다.

### 예시
```text
📦app
 ┣ 📂news
 ┃ ┣ 📂[...newsId]
 ┃ ┃ ┗ 📜page.js
 ┣ 📜favicon.ico
 ┣ 📜globals.css
 ┣ 📜layout.js
 ┗ 📜page.js
```
위와 같은 구조에서 **/app/news/1, /app/news/2, /app/news/2/1, /app/news/popular/1** 등 모든 경로로 접근이 가능해집니다.

<br>

## 1-5.  병렬 라우트 (Parallel Routes)
### 설명
병렬 라우트는 명명된 슬롯(named slots)을 사용하여 생성.슬롯은 @folderName 컨벤션으로 정의합니다. 각 슬롯은 props에 전달되며, children prop과 함께 병렬로 렌더링할 수  있도록 합니다.

동시에 혹은 조건부에 따라 동일한 레이아웃에서 하나 이상의 페이지를 렌더링 할 수 있도록하는 라우팅입니다.

대시보드나 소셜 사이트의 피드와 같은 동적인 앱 부분에서 주로 사용하며, 복잡한 라우팅 패턴을 구현할 수 있습니다.

병렬 라우팅을 사용하면 독립적으로 스트리밍되는 각 경로에 대해 독립적인 오류 및 로딩 상태를 정의할 수 있으며, 유저 인증 같은 특정 조건에서 렌더링 되는 페이지만을 조건부로 처리할 수 있습니다.

### 예시
@details 페이지, @side 페이지가 존재한다고 했을때, 두 페이지를 동시에 렌더링 할 수 있습니다. 두 가지 페이지는 `layout.js` 파일에서 관리 할 수 있습니다.
```text
📦app
 ┣ 📂news
 ┃ ┣ 📂@details
 ┃ ┃ ┗ 📜page.js
 ┃ ┣ 📂@sided
 ┃ ┃ ┗ 📜page.js
 ┃ ┣ 📜layout.js 
 ┃ ┗ 📜page.js
 ┣ 📜favicon.ico
 ┣ 📜globals.css
 ┣ 📜layout.js
 ┗ 📜page.js
```

```javascript
export default function Layout({ detail, side }) {
  const isLoggedIn = getUser()
  return (
    <>
      {isLoggedIn && detail}
      {side}
    </>
  )
}
```

<br>

## 1-6. 라우팅 그룹(Route Groups)
### 설명
라우트 그룹은 폴더 이름은 `괄호()`로 묶어 생성할 수 있습니다.
폴더를 라우트로 표시하여 해당 폴더가 URL 경로로 포함되지 않도록 할 수 있습니다.이를 통해 URL 경로 구조에 영향을주지 않고 라우트 세그먼트와 프로젝트 파일을 논리적으로 구성할 수 있습니다.

### 예시
```text
📦app
 ┣ 📂(product)
 ┃ ┣ 📂detail
 ┃ ┃   ┗ 📜page.js
 ┃ ┣ 📂about
 ┃ ┃   ┗ 📜page.js
 ┃ ┗ 📜layout.js
 ┣ 📂(seller)
 ┃ ┣ 📂about
 ┃ ┃    ┗ 📜page.js
 ┃ ┗ 📜layout.js
 ┣ 📜favicon.ico
 ┣ 📜globals.css
 ┣ 📜layout.js
 ┗ 📜page.js
```
(product) 과 (seller) 내부에 있는 라우트는 동일한 URL 계층 구조를 공유하지만 각각의 그룹에 layout.js 파일을 추가하여 독립적인 레이아웃을 생성할 수 있습니다. 그룹 외부의 레이아웃은 공유하지 않게됩니다.

### 주의사항
라우트 그룹을 포함하는 라우트는 다른 라우트와 동일한 URL 경로로 해석되어서는 안 됩니다.  라우트 그룹은 URL 구조에 영향을 주지 않으므로 (product)/about/page.js와 (seller)/about/page.js는 모두 /about으로 해석되어 오류가 발생할 수 있습니다.

최상위 레이아웃(layout.js 파일)이 없는 상태에서 여러 개의 루트 레이아웃을 사용하는 경우, page.js 파일은 라우트 그룹 중 하나에 정의되어야 합니다.

여러 개의 루트 레이아웃 간에 탐색할 경우 전체 페이지 로드가 발생합니다. 예를 들어, /app/(product)/layout.js를 사용하는 /detail에서 /app/(seller)/layout.js를 사용하는 /about로 이동하는 경우 전체 페이지 로드가 발생합니다. 이는 여러 개의 루트 레이아웃에만 해당됩니다.

<br>

## 1-7.  라우트 가로채기 (Intercepting Routes)
### 설명
라우트 가로채기는 현재 레이아웃 안에서 라우트를 로드하면서 현재 페이지의 컨텍스트를 유지할 수 있게 해줍니다. 이러한 라우팅 패러다임은 특정 경로를 "가로채서" 다른 경로를 표시하고 싶을 때 유용합니다.

라우트 가로채기는 (..) 구문을 사용하여 정의할 수 있습니다. 

예를 들어 (.)는 동일한 수준의 세그먼트와 일치, (..)는 한 수준 위의 세그먼트와 일치, (...)는 두 수준 위의 세그먼트와 일치하게됩니다.

라우트 가로채기는 병렬 라우트와 함께 사용하여 모달을 만드는 데 사용할 수 있습니다. 이러한 패턴으로 모달을 만들면 아래와 같은 장점이 있습니다.
- URL을 통해 모달 내용을 공유할 수 있습니다.
- 페이지를 새로 고침할 때 모달을 닫지 않고 컨텍스트를 보존할 수 있습니다.
- 이전 경로로 이동하는 대신 뒤로 가기로 모달을 닫을 수 있습니다.
- 앞으로 가기로 모달을 다시 열수 있습니다.

### 예시
아래 예시는 Login 페이지를 가로채서 모달창으로 로그인 페이지를 표시하도록 하는 프로젝트 구조 및 코드입니다.
```text
📦app
 ┣ 📂@modal
 ┃ ┣ 📂(.)login
 ┃ ┃  ┗ 📜page.js
 ┃ ┗ 📜default.js
 ┣ 📂login
 ┃  ┗ 📜page.js
 ┣ 📜globals.css
 ┣ 📜layout.js
 ┗ 📜page.js
```
```javascript
// /api/layout.ts
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import MainHeader from "@/components/MainHeader";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  modal,
  children,
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        {modal}
        {children}
      </body>
    </html>
  );
}

```
```javascript
// /app/login/page.js
export default function Login() {
  return (
    <form className="flex flex-col gap-1 absolute left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%] bg-gray-300 p-5 pb-6 rounded-md">
      <h2 className="text-center text-xl font-semibold mb-2">Login</h2>
      <label htmlFor="ID" className="sr-only">
        ID
      </label>
      <input
        id="ID"
        className="max-w-[320px] w-full px-4 py-2 border rounded-md"
        placeholder="ID"
      />

      <label htmlFor="PW" className="sr-only">
        PW
      </label>
      <input
        id="PW"
        className="max-w-[320px] w-full px-4 py-2 border rounded-md"
        placeholder="PW"
      />
    </form>
  );
}
```
```javascript
// /api/@modal/default.js
export default function ModalDefault() {
  return null;
}

```
```javascript
// /api/@modal/(.)login/page.js
"use client";
import { useRouter } from "next/navigation";
import React from "react";

export default function Login() {
  const router = useRouter();

  return (
    <>
      <div
        onClick={router.back}
        className="fixed bg-black bg-opacity-50 inset-0"
      />
      <form className="flex flex-col gap-1 absolute left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%] bg-gray-300 p-5 pb-6 rounded-md">
        <h2 className="text-center text-xl font-semibold mb-2">Login</h2>
        <label htmlFor="ID" className="sr-only">
          ID
        </label>
        <input
          id="ID"
          className="max-w-[320px] w-full px-4 py-2 border rounded-md"
          placeholder="ID"
        />

        <label htmlFor="PW" className="sr-only">
          PW
        </label>
        <input
          id="PW"
          className="max-w-[320px] w-full px-4 py-2 border rounded-md"
          placeholder="PW"
        />
      </form>
    </>
  );
}

```
<br>

### 1-8. 파일 규칙

중첩된 경로에서 특정 행위를 하는 UI를 생성하는 아래와 같은 파일 규칙들을 제공합니다.

`page` : 모든 라우터의 서브트리에 리프노드입니다. 페이지는 하나의 폴더에 하나만 존재할 수 있습니다. 기본적으로 서버 컴포넌트로 구성되며, 파일 최상단에 ‘use client’를 선언하여 클라이언트 컴포넌트로 사용가능합니다.

`layout` : 여러 페이지에서 공유하는 UI 입니다. 탐색하는 시점에도 레이아웃은 상태를 유지하고 리렌더링이 발생하지 않습니다. 레이아웃은 중첩 사용이 가능합니다.

`template` : 템플릿도 레이아웃과 비슷하게 각각의 자식 레이아웃이나 페이지를 감싸는 용도로 사용됩니다. 템플릿은 레이아웃과 다르게 탐색할 때마다 자식 요소마다 새로운 인스턴스를 생성합니다. 이는 템플릿을 공유하는 라우터 간에 이동할 대 컴포넌트의 새로운 인스턴스가 마운트 되고 DOM 엘리먼트가 새로 생기고 상태는 보존되지 않고 효과가 재동기화 된다는 것을 말합니다.

`not-found` : ‘Not Found’ 오류에 대한 폴백 페이지를 구성합니다.

`error` : 기타 오류에 대한 폴백 페이지를 구성합니다.

`loading` : 형제 또는 중첩 페이지(또는 레이아웃)가 데이터를 가져오는 동안 표시되는 폴백 페이지 구성합니다.

`default` : Next.js가 전체 페이지 로드 후 폴더의 하위 페이지를 복구할 수 없을 때 Parallel Routes default.js 내에서 폴백을 렌더링하는 데 사용됩니다 .

파일 규칙에 정의된 컴포넌트들은 계층 구조로 렌더링됩니다.

다른 파일 규칙들은 아래 공식문서를 참고해주세요.

[API Reference: File Conventions](https://nextjs.org/docs/app/api-reference/file-conventions)

<br/>

### 1-9. 보호 컴포넌트

app 폴더에서 파일 규칙을 제외하고 다른 파일은 라우팅되지 않습니다.

app 파일 내부에 components 폴더는 라우팅에 포함되지 않습니다.

<br/>

## 🔍 참고 사이트
https://rocketengine.tistory.com/entry